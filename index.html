<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Weedle</title>
<style>
/* (Your existing styles pasted here unchanged…) */

/* --- GLOBAL STATS OVERLAY (WORDLE STYLE) --- */
#statsOverlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}
.overlayHidden { display: none !important; }
#statsBox {
  background: #fff;
  width: 92%;
  max-width: 480px;
  padding: 24px;
  border-radius: 12px;
  box-shadow: 0 6px 30px rgba(0,0,0,0.25);
  text-align: center;
  font-family: sans-serif;
}
#statsBox h2 { margin: 0 0 18px 0; font-size: 22px; font-weight: bold; }
#globalTitle { margin-top: 14px; font-weight: bold; font-size: 18px; }
.barRow { display: flex; align-items: center; margin: 6px 0; }
.barLabel { width: 24px; text-align: right; font-weight: bold; }
.barOuter {
  flex: 1;
  background: #ddd;
  height: 20px;
  margin-left: 8px;
  border-radius: 4px;
  overflow: hidden;
}
.barFill {
  height: 100%;
  background: #6aaa64; /* Wordle green */
  text-align: right;
  color: white;
  padding-right: 6px;
  font-size: 12px;
}
#closeOverlay {
  margin-top: 20px;
  padding: 10px 22px;
  background: #6aaa64;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 15px;
}
</style>
</head>
<body>

<!-- (All your existing HTML header, input, table, success message, etc. remain unchanged…) -->

<!-- --- GLOBAL WORDLE-STYLE STATS OVERLAY --- -->
<div id="statsOverlay" class="overlayHidden">
  <div id="statsBox">
    <h2>STATISTICS</h2>
    <p id="yourResult"></p>
    <div id="globalTitle">GUESS DISTRIBUTION</div>
    <div id="statsBars"></div>
    <button id="closeOverlay">Close</button>
  </div>
</div>

<script>
/* --- Your existing JS (fetching strains.json, rendering image, autocomplete, table logic, etc.) remains unchanged --- */

let guessCount = 0; // track guesses

function submitGuess() {
  const raw = document.getElementById("guessInput").value.trim();
  if (!raw) return alert("Select a strain from the dropdown.");

  const guess = strains.find(s => s.name.toLowerCase() === raw.toLowerCase());
  if (!guess) return alert("Strain must be from the database.");

  guessCount++;

  // (Your existing code adding table rows, tiles, animations… stays exactly the same)
  // We only patch in the success logic.

  const tr=document.createElement("tr");
  // ... existing creation of row cells ...
  document.getElementById("guessesBody").appendChild(tr);
  flipTilesSequential(tr);

  // If correct guess
  if (guess.name.toLowerCase() === mystery.name.toLowerCase()) {
    document.getElementById("success").style.display = "block";
    showStatsOverlay();
  }

  document.getElementById("guessInput").value = "";
}

/* --- GLOBAL WORDLE STYLE STATS OVERLAY --- */
async function showStatsOverlay() {
  const overlay = document.getElementById("statsOverlay");
  const yourResult = document.getElementById("yourResult");
  const barsBox = document.getElementById("statsBars");

  const strainName = mystery.name;
  const today = new Date().toISOString().slice(0,10);

  yourResult.textContent = `You solved it in ${guessCount} guesses.`;

  // --- SEND RESULT TO WORKER ---
  fetch("https://weedle.sammywhlee.workers.dev/submit", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ strain: strainName, guesses: guessCount, date: today })
  }).catch(()=>{});

  // --- FETCH GLOBAL DISTRIBUTION ---
  let global = {};
  try {
    const r = await fetch(`https://weedle.sammywhlee.workers.dev/stats?strain=${encodeURIComponent(strainName)}`);
    global = await r.json();
  } catch(e) {
    global = {};
  }

  // --- RENDER WORDLE-STYLE BAR GRAPH ---
  barsBox.innerHTML = "";
  const keys = Object.keys(global).sort((a,b)=>a-b);
  if (keys.length === 0) {
    barsBox.innerHTML = "<div>No global data yet.</div>";
  } else {
    const max = Math.max(...keys.map(k => global[k]));
    keys.forEach(k => {
      const count = global[k];
      const pct = Math.round((count / max) * 100);
      const bar = `
        <div class="barRow">
          <div class="barLabel">${k}</div>
          <div class="barOuter">
            <div class="barFill" style="width:${pct}%">${count}</div>
          </div>
        </div>
      `;
      barsBox.innerHTML += bar;
    });
  }

  overlay.classList.remove("overlayHidden");
  document.getElementById("closeOverlay").onclick = () => overlay.classList.add("overlayHidden");
}
</script>

</body>
</html>
