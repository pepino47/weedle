<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Weedle â€” Guess the daily strain</title>

<style>
/* ------------------ THEME ------------------ */
:root{
  --bg:#f6f7f8;
  --card:#ffffff;
  --muted:#6b7280;
  --green:#6aaa64;
  --yellow:#c9b458;
  --gray:#787c7e;
  --max-width:760px;
  font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto;
}

html,body{margin:0; background:var(--bg); color:#0b1220;}
.wrap{display:flex; justify-content:center; padding:30px 12px;}
.card{width:100%; max-width:var(--max-width); background:var(--card); padding:20px; border-radius:14px; box-shadow:0 8px 40px rgba(0,0,0,0.06);}

/* ------------------ HEADER ------------------ */
header{display:flex; gap:14px; align-items:center;}
#logo{width:120px; height:auto;}
h1{margin:0; font-size:1.25rem;}

/* ------------------ STRAIN IMAGE ------------------ */
#strainImageBox { width: 100%; text-align: center; margin-top: 20px; margin-bottom: 25px; }
#strainImage {
  width: 100%; max-width: 260px; height: auto;
  border-radius: 16px; box-shadow:0 4px 20px rgba(0,0,0,0.12);
  display: block; margin: 0 auto;
}
#strainLabel {
  margin-top: 8px; font-size: 14px;
  color: var(--muted); text-align: center;
}

/* ------------------ INPUT + DROPDOWN ------------------ */
.controls{display:flex; gap:12px; margin-top:12px;}
#guessContainer{position:relative; width:320px;}
#guessInput{
  width:100%; padding:10px 12px; border-radius:8px;
  border:1px solid #d1d5db; font-size:15px;
  background:white; box-sizing:border-box;
}
#dropdown{
  position:absolute; top:100%; left:0; right:0; background:white;
  border:1px solid #d1d5db; border-top:none; display:none;
  max-height:200px; overflow:auto; border-radius:0 0 8px 8px; z-index:40;
}
.dd-item{padding:10px; cursor:pointer;}
.dd-item:hover{background:#f3f4f6;}

/* ------------------ TABLE ------------------ */
table{width:100%; border-collapse:collapse; margin-top:20px;}
thead th{
  background:#111827; color:white; padding:12px 14px;
  font-weight:600; text-align:left;
}
tbody td{
  padding:12px 14px; border-bottom:1px solid #eef2f7;
}

/* ------------------ WORDLE TILES ------------------ */
.tile{
  display:inline-block; min-width:44px; text-align:center;
  padding:8px 10px; border-radius:6px; color:white;
  font-weight:700; font-size:14px; transform-style:preserve-3d;
  transition:transform 0.25s ease-in;
}
.green{background:var(--green);}
.yellow{background:var(--yellow); color:#0b1220;}
.gray{background:var(--gray);}
.flip{ transform:rotateX(90deg); }
.flip.show{ transform:rotateX(0deg); }

/* ------------------ SUCCESS ------------------ */
#success{
  display:none; margin-top:14px; padding:12px;
  background:var(--green); color:white; text-align:center;
  font-weight:700; border-radius:8px;
}

/* ------------------ STATS OVERLAY ------------------ */
#statsOverlay {
  position: fixed;
  inset: 0;
  backdrop-filter: blur(6px);
  background: rgba(0,0,0,0.45);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 200;
}
#statsCard {
  background: white;
  padding: 26px;
  width: 90%;
  max-width: 420px;
  border-radius: 14px;
  box-shadow: 0 10px 40px rgba(0,0,0,0.2);
  text-align: center;
}
.stats-bar {
  background: #d1d5db;
  height: 22px;
  border-radius: 6px;
  margin-top: 6px;
  text-align: left;
  font-size: 13px;
  padding-left: 6px;
  line-height: 22px;
}
.stats-bar.green { background: var(--green); color: white; }
</style>
</head>

<body>
<div class="wrap">
<div class="card">

<header>
  <img id="logo" src="images/weedle.jpg" alt="weedle logo">
  <div>
    <h1>Weedle â€” Guess the daily strain</h1>
    <div style="font-size:13px; color:var(--muted); margin-top:6px;">
      Guess the daily strain using Wordle-style clues.
    </div>
  </div>
</header>

<!-- DAILY STRAIN IMAGE -->
<div id="strainImageBox">
  <img id="strainImage" src="">
  <div id="strainLabel"></div>
</div>

<!-- INPUT CONTROLS -->
<div class="controls">
  <div id="guessContainer">
    <input id="guessInput" autocomplete="off" placeholder="Type to search strainsâ€¦" />
    <div id="dropdown"></div>
  </div>
  <button id="submitBtn">Submit</button>
  <button id="resetBtn">Reset</button>
</div>

<!-- RESULTS TABLE -->
<table>
<thead>
<tr>
  <th>Strain</th>
  <th>Letters</th>
  <th>Type</th>
  <th>THC %</th>
  <th>Dominant Terpene</th>
  <th>Year</th>
</tr>
</thead>
<tbody id="guessesBody"></tbody>
</table>

<div id="success">ðŸŽ‰ You found todayâ€™s strain! ðŸŽ‰</div>

</div>
</div>

<!-- POST-GAME STATS OVERLAY -->
<div id="statsOverlay">
  <div id="statsCard">
    <h2 id="statsTitle"></h2>
    <div id="statsGuesses"></div>

    <h3 style="margin-top:22px;">Today's Guess Distribution</h3>
    <div id="statsBars"></div>

    <button id="closeStats" style="margin-top:20px;">Close</button>
  </div>
</div>

<script>
let strains = [];
let mystery;
let guessCount = 0;
const MAX_GUESSES = 6;

/* LOAD STRAINS */
fetch("strains.json")
  .then(res => res.json())
  .then(data => { strains = data; initializeGame(); });

/* INITIALIZE GAME */
function initializeGame() {
  const withImages = strains.filter(s => s.image);
  const pool = withImages.length ? withImages : strains;

  function dailyIndex(d = new Date()) {
    const epoch = Date.UTC(2023,0,1);
    const today = Date.UTC(d.getUTCFullYear(), d.getUTCMonth(), d.getUTCDate());
    return Math.floor((today - epoch) / 86400000) % pool.length;
  }

  mystery = pool[dailyIndex()];
  loadDailyStrainImage();
  enableInputHandlers();
}

/* DISPLAY DATE & IMAGE */
function loadDailyStrainImage() {
  const strainImageEl = document.getElementById("strainImage");
  const strainLabelEl = document.getElementById("strainLabel");

  const today = new Date();
  const dateStr = today.toLocaleDateString("en-US", {
    weekday:"long", month:"long", day:"numeric", year:"numeric"
  });

  strainLabelEl.textContent = `Strain of the Day â€” ${dateStr}`;

  if (mystery.image) {
    strainImageEl.src = "images/" + mystery.image;
    strainImageEl.style.display = "block";
  } else {
    strainImageEl.style.display = "none";
  }
}

/* HELPERS */
const strip = s => s.replace(/\s+/g,'');
const letters = s => strip(s).length;
const arrow = (g,t)=> g===t ? "" : (g<t?"â†‘":"â†“");

function alphaProximityColor(guessName, mysteryName) {
  const g = guessName[0].toLowerCase();
  const m = mysteryName[0].toLowerCase();
  if (g === m) return "green";
  if (Math.abs(g.charCodeAt(0) - m.charCodeAt(0)) <= 1) return "yellow";
  return "gray";
}

function typeProximityColor(a,b){
  const order=["sativa","sativa/hybrid","hybrid","indica/hybrid","indica"];
  const ai=order.indexOf(a.toLowerCase());
  const bi=order.indexOf(b.toLowerCase());
  if(ai===-1||bi===-1) return "gray";
  if(ai===bi) return "green";
  return Math.abs(ai-bi)===1?"yellow":"gray";
}

function colorNum(g,t,thr){
  if(g===t) return "green";
  if(Math.abs(g-t)<=thr) return "yellow";
  return "gray";
}

/* INPUT HANDLERS */
function enableInputHandlers() {
  const guessInput = document.getElementById("guessInput");
  const dropdown = document.getElementById("dropdown");

  guessInput.addEventListener("input", e => {
    const q = e.target.value.trim().toLowerCase();
    dropdown.innerHTML="";
    if(!q){ dropdown.style.display="none"; return; }

    const matches = strains.filter(s => s.name.toLowerCase().includes(q));
    matches.forEach(s=>{
      const d=document.createElement("div");
      d.className="dd-item";
      d.textContent=s.name;
      d.onclick=()=>{ guessInput.value=s.name; dropdown.style.display="none"; };
      dropdown.appendChild(d);
    });
    dropdown.style.display = matches.length?"block":"none";
  });

  document.getElementById("submitBtn").onclick = submitGuess;
  document.getElementById("resetBtn").onclick = resetGame;
}

/* RESET */
function resetGame() {
  guessCount = 0;
  document.getElementById("guessesBody").innerHTML = "";
  document.getElementById("success").style.display = "none";
  document.getElementById("guessInput").value = "";
}

/* SUBMIT GUESS */
function submitGuess() {
  if (guessCount >= MAX_GUESSES) {
    alert("You've reached the maximum of 6 guesses.");
    return showStatsOverlay(false);
  }

  const raw = document.getElementById("guessInput").value.trim();
  if (!raw) return alert("Select a strain from the dropdown.");

  const guess = strains.find(s => s.name.toLowerCase() === raw.toLowerCase());
  if (!guess) return alert("Strain must be from the database.");

  guessCount++;

  const tr=document.createElement("tr");

  /* NAME */
  const nameTd=document.createElement("td");
  nameTd.appendChild(tile(guess.name, alphaProximityColor(guess.name, mystery.name)));

  /* LETTERS */
  const ls = letters(guess.name);
  const lt = letters(mystery.name);
  const lettersTd=document.createElement("td");
  lettersTd.appendChild(tile(`${ls} ${arrow(ls,lt)}`, colorNum(ls,lt,1)));

  /* TYPE */
  const typeTd=document.createElement("td");
  typeTd.appendChild(tile(guess.type, typeProximityColor(guess.type, mystery.type)));

  /* THC */
  const thcTd=document.createElement("td");
  thcTd.appendChild(tile(`${guess.thc}% ${arrow(guess.thc,mystery.thc)}`, colorNum(guess.thc,mystery.thc,2)));

  /* TERPENE */
  const terpTd=document.createElement("td");
  terpTd.appendChild(tile(guess.terpene, guess.terpene.toLowerCase()===mystery.terpene.toLowerCase() ? "green" : "gray"));

  /* YEAR */
  const yearTd=document.createElement("td");
  yearTd.appendChild(tile(`${guess.year} ${arrow(guess.year,mystery.year)}`, colorNum(guess.year,mystery.year,2)));

  tr.appendChild(nameTd);
  tr.appendChild(lettersTd);
  tr.appendChild(typeTd);
  tr.appendChild(thcTd);
  tr.appendChild(terpTd);
  tr.appendChild(yearTd);

  document.getElementById("guessesBody").appendChild(tr);
  flipTilesSequential(tr);

  /* WIN */
  if (guess.name.toLowerCase() === mystery.name.toLowerCase()) {
    document.getElementById("success").style.display="block";
    return showStatsOverlay(true);
  }

  /* OUT OF GUESSES */
  if (guessCount >= MAX_GUESSES) {
    return showStatsOverlay(false);
  }

  document.getElementById("guessInput").value="";
}

/* TILE + ANIMATION */
function tile(content,color){
  const el=document.createElement("span");
  el.className=`tile flip ${color}`;
  el.textContent=content;
  return el;
}

function flipTilesSequential(container){
  const tiles=[...container.querySelectorAll(".tile")];
  tiles.forEach((t,i)=>{
    setTimeout(()=>{ t.classList.remove("flip"); t.classList.add("show"); }, i*180);
  });
}

/* STATS OVERLAY */
function showStatsOverlay(won) {
  const overlay=document.getElementById("statsOverlay");
  const title=document.getElementById("statsTitle");
  const g=document.getElementById("statsGuesses");
  const bars=document.getElementById("statsBars");

  title.textContent = won
    ? `You solved Weedle in ${guessCount} guess${guessCount!==1?"es":""}!`
    : `Out of guesses â€” the strain was ${mystery.name}`;

  g.textContent = `Guesses used: ${guessCount} / 6`;

  /* Fake global distribution â€” replace with real data later */
  const fakeDist=[0,12,22,34,18,9];
  bars.innerHTML="";

  fakeDist.forEach((v,i)=>{
    const bar=document.createElement("div");
    bar.className="stats-bar";
    bar.style.width=(v*3)+"px";
    bar.textContent=`${i+1}: ${v}`;
    if(won && i+1===guessCount) bar.classList.add("green");
    bars.appendChild(bar);
  });

  overlay.style.display="flex";
  document.getElementById("closeStats").onclick=()=>{ overlay.style.display="none"; };
}
</script>

</body>
</html>
